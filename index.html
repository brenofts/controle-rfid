<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="style.css" />
		<link rel="icon" type="imagem/png" id="fav" href="imagens/alert.gif" />
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>OGCOT - Controle de TPs</title>
	</head>

	<body>
		<div class="title">
			<h1 id="nomePosto">OGCOT</h1>
		</div>
		<center>
			<div id="alert"></div>
		</center>
		<div class="hidden" id="conectando">
			<div class="lds-dual-ring"></div>
		</div>
		<div class="seletor hidden" id="divSelecaoPosto">
			<h2>Selecione o posto</h2>
			<select name="Selecione o posto" id="selectPosto">
				<option value="pst">POSTO</option>
				<option value="T-PAC">T-PAC</option>
				<option value="T-PAS">T-PAS</option>
				<option value="FILA-CLA">FILA-CLA</option>
			</select>
			<button class="botao-principal" id="btnSelecionarPosto">Selecionar</button>
		</div>
		<div id="checarGerente">
			<div id="inputChecarGerente"></div>
			<div class="lds-ripple"><div></div><div></div></div>
		</div>
		<div id="contador">
			<div></div>
			<div>Sua sessão expira em </div>
			<div></div>
		</div>
		<div id="principal">
			<div class="menu" id="opcoes">
				<button class="botao-principal" id="btnVoltar">Início</button>
				<button class="botao-principal" id="btnControle">Controle</button>
				<button class="botao-principal" id="btnBusca">Busca</button> 	
				<button class="botao-principal" id="btnTransporte">Transporte</button>
				<button class="botao-principal" id="btnCadastro">Cadastro</button>
				<button class="botao-principal" id="btnSenhas">Senhas</button>
				<button class="botao-principal" id="falhaLeitor">Falha no leitor</button>
			</div>
			<div class="paginas">
				<div title="Aproxime o TP do leitor para iniciar o Registro." class="pagina" id="inicio">
					<div id="leitor">
						<h2>Apresente TP</h2>
					<div autocomplete="off" id="formRFIDTP">
							<div class="lds-ripple"><div></div><div></div></div>
							<input class="input-hidden" type="password" name="tag" id="inputTagTP" size=7 maxlength="10" title="Leitura RFID" onselect="notAllowed()"/>
					</div>
					<button class="botao-principal" id="maisOpc" title="Buscas, Cadastro, Transporte...">Mais opções</button>
					</div>
					<div id="grid-inicio" title="Em verde até 2 dias, em amarelo de 2 a 3 dias e em vermelho mais de 3 dias">
						<div id="tpsEmUso" class="grid-container-inicio">
					</div>
					</div>
				</div>
				<div class="leitor" id="retirar">
					<h1>Retirar</h1>
					<div id="numTPRetirar"></div>
					<div id="idRetirar"></div>
					<div id='divFormIDRetirar'>
						<form autocomplete="off" id="formRFIDRetirar">
								<div class="lds-ripple"><div></div><div></div></div>
								<legend>Apresente a TAG do usuário</legend>
								<label><input class="input-hidden" type="password" name="tag" id="inputTagUsuario" size="10" maxlength="10" /></label>
							
							<!--Botão que possibilita retirar sem tag-->
						</form>
						<button class="botao-principal" id="btnRetirar" title="Disponibiliza retiradada pelo empregado sem a Tag, utilizando Matrícula e Senha.">Retirar sem Tag</button>
					</div>
					<!--Form abaixo contem o quadro onde se endtra com matrícula e senha; matrícula com 5 dígitos e 
						senha com quatro dígitos.-->
						<div id='divFormSenhaRetirar' class="pagina">
							<form autocomplete="off" id="formSenhaRetirar">
								
									<legend>Usuário</legend>
									<input type="text" placeholder="Matrícula" id="inputMatrRetirar" size="10" maxlength="5"/> 
									<input type="password" placeholder="Senha" name="pinRets" id="inputSenhaRetirar" size="10" maxlength="4"/>
									<button class="hidden botao-secundario" onclick="reload()" id="cancelaRetirar" title="Cancela">Cancelar</button>
								
							</form>
							<br><br><br>
							<button class="hidden botao-secundario" id="btnRetirarOutro">Escolher outro TP</button>
							<button class="botao-secundario" id = "utilizarTagRet" title="Possibilita retornar para o registro do usuário com Tag.">Retirar com Tag</button>
							<button class="botao-secundario" id="btnEsqueciRetirar">Esqueci a senha</button>
							 </div>
				</div>
				<div class="leitor" id="devolver">
					<h1>Devolver</h1>
					<div id="numTPDevolver"></div>
					<div id="idTPDevolver"></div>
					<div id="divFormRFIDDevolver">
						<form autocomplete="off" id="formRFIDDevolver">
								<div class="lds-ripple"><div></div><div></div></div>
								<legend>Apresente a TAG de gerente</legend>
								<input class="input-hidden" type="password" name="tag" id="inputTagGerente" size="10" maxlength="10" />
							
						</form>
						<button class="botao-secundario" id="btnDevolver">Devolver sem Tag</button>
						<button class="botao-secundario" id="btnEsqueciDevolver">Esqueci a senha</button>
					</div>
					<div id="divFormSenhaDevolver" class="pagina">
						<form autocomplete="off" id="formSenhaDevolver">
							
									<legend id="nomeDoGerente">Gerente</legend>
									<input type="text" placeholder="Matrícula" id="inputMatrDevolver" size="10" maxlength="5"/><br>
									<input type="password" placeholder="Senha" id="inputSenhaDevolver" size="10" maxlength="4" />
									<button class="hidden botao-secundario" onclick="reload()" id="cancelaDevolver" title="Cancela">Cancelar</button>
							
						</form>
							<br><br><br>
							<button class="hidden botao-secundario" id="btnDevolverOutro">Escolher outro TP</button>
							<button class="botao-secundario" id = "utilizarTagDev" title="Possibilita retornar para o registro do usuário com Tag.">Devolver com Tag</button>
					</div>
				</div>
				<div class="secundario" id="transporte">
					<h1>Transporte</h1>
					<h3 id="idTransporte"></h3>
					<div class="lds-ripple"><div></div><div></div></div>
					<label>Apresente TP</label>
					<form autocomplete="off" id="az">
						<input  class="input-hidden" type="password" name="tagTpTransp" id="inputTagTPTransp">
					</form>
					<div class="hidden"  id="divTPsIncluidos">
						<h3>TPs incluídos<span id="countIncluidos"></span></h3>
						<div id="gridTPsIncluidos" class="grid-transporte"></div>
						<div style="display: inline;">
						<button id="btnTrasnportar" onclick="checkOut()">Confirmar</button>
						<button id="btnTrasnportar" onclick="reload()">Cancelar</button>
						</div>
					</div>
				</div>
				<div class="pagina" id="controle">
					<div id="processando"></div>
					<table class="tabela" id="tabelaControle">
						<caption id="updateTime"></caption>
						<tr>
							<th>TP</th>
							<th>Status</th>
							<th>Dias</th>
							<th>Data</th>
							<th>Hora</th>
							<th>Piloto</th>
							<th>Gerente</th>
							<th>Posto</th>
						</tr>
						<tbody id="bodyControle"></tbody>
					</table>
				</div>
				<div class="secundario" id="busca">
					<h1 id="h1Busca">Busca</h1>
					<div id="btnsBusca">
						<button class="botao-secundario" id="btnBuscaMatr">Matrícula</button>
						<button class="botao-secundario" id="btnBuscaData">Data</button>
						<button class="botao-secundario" id="btnBuscaTP">TP</button>
						<button class="botao-secundario" id="btnBuscaPosto">Posto</button>
					</div>
					<div class="pagina" id="buscaMatr" title="Digite a matrícula para visualizar todos os registros desse empregado" >
						<form autocomplete="off" id="formBuscaMatr">
							<input type="text" placeholder="Matrícula" name="matricula" id="inputMatrBuscar" />
							<input class="btnBuscar" type="submit" value="Buscar" id="btnBuscarMatr" />
						</form>
					</div>
					<div class="pagina" id="buscaData">
						<form autocomplete="off" id="formBuscaData" title="Retorna todos os registros do dia selecionado na 'Data Inicial' ou no período, havendo seleção da 'Data Inicial' e 'Data Final'. " >
							<label for="inputDataInicial">Data Inicial</label>
							<input id="inputDataInicial" type="date" />
							<label id='lblDataFinal'for="inputDataFinal" class="hidden">Data Final</label>
							<input  id="inputDataFinal" class="hidden" type="date" />
							<input class="hidden btnBuscar" type="submit" id="btnBuscarData" value="Buscar" />
						</form>
					</div>
					<div class="pagina" id="buscaTP">
						<h2 title = "Escolha o TP no qual queira ver o Histórico de Registros">Busca por TP</h2>
						<div class="grid-container" id="tabelaBuscaTPs"></div>
					</div>
					<div class="pagina" id="buscaPosto" title="Retorna todos os registros do posto">
						<h2 id="idSelPosto">Selecione o Posto</h2>
						<select name="buscaTp" id="selBuscaPosto">
								<option value="T-PAS">T-PAS</option>
								<option value="T-PAC">T-PAC</option>
								<option value="FILA-CLA" selected>FILA-CLA</option>
						</select> <input class="btnBuscar" type="submit" id="btnBuscarPosto" value="Buscar" />
						
				</div>
				</div>
				<div class="pagina" id="tabela">
					<table>
						<caption id="tituloTabela"></caption>
						<tr>
							<th>TP</th>
							<th>Status</th>
							<th>Data</th>
							<th>Hora</th>
							<th>Piloto</th>
							<th>Gerente</th>
							<th>Posto</th>
						</tr>
						<tbody id="bodyTabela"></tbody>
					</table>
				</div>
				<div class="secundario" id="cadastro">
					<h1>Cadastro</h1>
					<div class="menu1">
						<button class="botao-secundario" id="btnCadastroUsuario">Usuário</button>
						<button class="botao-secundario" id="btnCadastroTp">TP</button>
					</div>
					<div class="pagina" id="cadastroTp">
						<div id="opcoesTP">
							<h3>TP</h3>
							<button class="botao-secundario" id="btnAtualizarTP">Atualizar TP</button>
							<button class="botao-secundario" id="btnNovoTP">Novo TP</button>
							<button class="botao-secundario" id="btnObsTP">Observações TP</button>
							<div class="terciario" id="divObsTp">
								<h3>Observações</h3>
								<h3 id="mostraNumTPobs"></h3>
								<input autocomplete="off" width="100%" size="30" placeholder="Digite aqui o número do TP"  id="inputObsNumTP" title="Digite a numeração completa do TP, com 5 dígitos" maxlength=5>
								<div class="terciario" id="divBotoesObs">
								<button class="botao-secundario" id="btnDesbloquearTP" title="Clique para DESBLOQUEAR o aparelho sendo necessário escrever o Motivo.">Desbloquear TP</button>
								<button class="botao-secundario" id="btnEscreverObsTP" title="Clique para ESCREVER as observações do aparelho. Aqui é possível Bloquear o aparelho.">Escrever Observações</button>
								<button class="botao-secundario" id="btnVoltarObsTp" title="Volte para escolher outro TP">Voltar</button>
								</div>

								<div class="terciario" id="divEscreveObs">
									<div id="infoTPobs"></div>
								<textarea autocomplete="off" width="40vw" height="50vh"  placeholder="Digite aqui a observação a ser Registrada: máximo de 1000 caracteres" id="inputObservacao" maxlength=1000></textarea>
								<div id="opcoesBloquear" title="Bloqueia o TP para futuros registros.">
								<form>
									<label>Bloquear TP?</label>
									<label><input type="radio" name="bloquear" value="sim"> Sim </label>
									<label><input type="radio" name="bloquear" value="nao"> Não </label>
								</form>
								</div>
								<button class="botao-secundario" id="escreveObs" title="Clique para efetivar o Registro da Observação">Enviar</button>
								</div>
								<div class="terciario" id="divLerObs">
									<div id="divMostraObs">
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="menu-oculto" id="opcoesUsuario">
											<h3>Usuário</h3>
											<div class="menu1">
											<button class="botao-secundario" id="btnAtualizarUsuario">Atualizar Cadastro</button>
											<button class="botao-secundario" id="btnNovoUsuario">Novo Cadastro</button>
											</div>
											<div style="margin-top: 35px;">
												<div class="hidden" id="divNovoUsuario">
													<legend>Novo Usuário</legend>
													
														<form class="grid" autocomplete="off" id="formNovoUsuario">
																<label for="matricula">Matrícula</label>
																		<input type="text" name="matricula" placeholder="Matrícula" id="matriculaNovo" size=7 maxlength="5">
																
																<label for="id">Login SEI</label>
																		<input type="text" name="id" placeholder="login.sei" id="idNovo" size="15">
																
																<label for="tag">TAG RFID</label>
																<h3>Apresente a nova TAG no leitor</h3>
																<input type="password" placeholder="Apresente no leitor" name="tag" id="tagNovo" size=7>
															
																<label for="cargo">Cargo</label>
																		<select name="cargo" id="cargo">
																			<option value="Piloto">Piloto</option>
																			<option value="IT">Inspetor</option>
																			<option value="Gerente">Gerente</option>
																		</select>
																
																<p></p>
																<input class="btnBuscar" type="submit" value="Cadastrar">
														</form>
									
													</div>
											</div>
												<div style="margin-top: 35px;">
												<div class="hidden" id="divAtualizarUsuario">
													<legend>Atualizar Usuário</legend>
													<h2 id='idEncontrado'></h2>
														<form autocomplete="off" id="formAtualizarUsuario">
																<input type="text" name="matricula" placeholder="Matrícula" id="inputMatrAtualiza" size=7 maxlength="5"><br>
																<button class="botao-terciario"  id='lerMatr'>Ir</button>
															</form>
															<div class ="hidden" id="divTagAtualiza">
																<h2>Aproxime a nova TAG do leitor</h2>
																<input  class="input-hidden"  type="password" id="inputTagAtualiza">
																<div class="lds-ripple"><div></div><div></div></div>
															</div>
															<div id='botoesTagGer' class='hidden'>
																<button class="botao-terciario"  id='desbloqueiaUsuario'title="Use caso usuário esteja impedido de efetuar registros. Ex: empregado perdeu TP; o TP precisa ser bloqueado, com isso não é possível devolve-lo e o usuário fica com o nome impedido de retirar outro TP">Desbloquear Usuário</button>
																<button class="botao-terciario"  id='trocaTag' title="Use somente caso o Empregado tenha Perdido sua TAG">TAG</button>
																<button class="botao-terciario"  id='trocaGerente' title="Concede ou Retira credencial de Gerente dentro do sistema controle de TPs" >Função</button>
																<button class="botao-terciario"  id='voltarTag'>Voltar</button>
															</div>
									
														</div>
											</div>
					
									<div id="divAtualizarCadastro"></div>
				</div>
	
				</div>
				<div class="secundario" id="senhas">
					<h1>Senhas</h1>
					<div>
						<button class="botao-secundario" id="btnEsqueci" onclick="abrirEsqueci()">Esqueci a senha</button>
						<button class="botao-secundario" onclick="abrirAtualiza()">Atualizar a senha</button>
					</div>
					<div class="pagina" id="esqueciSenha">
							<h3 id="idEsqueci"></h3>
							<input autocomplete="off" placeholder="Matrícula" size="8" maxlength="5" type="text" id="matriculaEsqueci">
							<button  class="botao-terciario"  id="btnEnviarEqueci">Enviar e-mail</button>
					</div>
					<div class="pagina" id="atualizarSenha">
						<div id="login">
							
								<legend>Login</legend>
									<h3 id="idLogin"></h3>
									<form class="grid" autocomplete="off" id="login">
													<input type="text" name="matricula" placeholder="Matrícula" id="matriculaLogin" size=7 maxlength="5">
													<input type="password" name="senha" maxlength="4" placeholder="Senha" id="senhaLogin" size="7" width="4" title="Digite a senha com 4 dígitos">
									</form>
							
						</div>
						<div class="hidden" id="divNovaSenha">
							
								<legend>Nova Senha</legend>
									<h3 id="idNovaSenha"></h3>
									<form autocomplete="off" id="formNovaSenha">
									
													<input type="password" onkeypress="return onlynumber()" inputmode="numeric" name="senha" maxlength="4" placeholder="Nova Senha" id="pinNovo" title="Digite a Nova Senha com 4 dígitos">
												
													<input type="password" onkeypress="return onlynumber()" inputmode="numeric" name="senha1" maxlength="4" placeholder="Repita Nova Senha" id="pinNovo1" title="Digite novamente a Nova Senha com 4 dígitos">
													<label for="mostraSenha">	
													<input type="checkbox" value="value" onclick="mostrarOcultar()" name="mostraSenha" id="mostraSenha">Mostrar Senha</label>	
													<button id="cancelaTrocaSenha" class="botao-terciario">Cancelar</button>														
									</form>
							
						</div>
					</div>
				</div>
				<div class="secundario" id="selecionarTP">
				<h1>Selecione o TP</h1>
				<div class="grid-container" id="tabelaTPs">
	
				</div>
				</div>
			</div>
		</div>
		<div id="rodape" class="rodape hidden" >
			<div>TPs com observação: &nbsp;</div>
			<div id="mostraObsDeTp"></div>
			<div id="printObs" class="hidden">
				<!-- <div class="cardObs">
					<h1 id="tituloObs">50001</h1>
					<h2 class="dataObs">01-07-2021 09:00:00</h2>
					<h2 class="gerenteObs">breno.silva</h2>
					<h2 class="postoObs">FILA-CLA</h2>
					<p class="obs">Texto da observação Texto da observação Texto da observação Texto da observação Texto da observação Texto da observação</p>
					<div class="ultimoRegistro">
					<p>Último registro anterior à observação: </p>
					<p class="dataUltimo">30-06-2021 09:00:00</p>
					<p class="statusUltimo">Status: Devolvido</p>
					<p class="idUltimo">Piloto: julio.nicesio</p>
					<p class="gerenteUltimo">Gerente: robert.anthony</p>
					<p class="postoUltimo">Posto: T-PAS</p>
					</div>
				</div> -->
			</div>
		</div>
		<script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-app.js"></script>
		<script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-database.js"></script>
		<script src="https://www.gstatic.com/firebasejs/8.2.7/firebase-auth.js"></script>

		<script>
			var firebaseConfig = {
				apiKey: 'AIzaSyB1rkLkF8gQsQNaiXdBt6zzpy2fYSm-64I',
				authDomain: 'controle-tp-web.firebaseapp.com',
				databaseURL: 'https://controle-tp-web.firebaseio.com',
				projectId: 'controle-tp-web',
				storageBucket: 'controle-tp-web.appspot.com',
			}

			firebase.initializeApp(firebaseConfig)

			const db = firebase.database()
		</script>
		<script src="./scripts/script.js"></script>
		<script src="./scripts/inicio.js"></script>
		<script src="./scripts/retirar.js"></script>
		<script src="./scripts/devolver.js"></script>
		<script src="./scripts/busca.js"></script>
		<script src="./scripts/buscaMatr.js"></script>
		<script src="./scripts/buscaData.js"></script>
		<script src="./scripts/buscaPosto.js"></script>
		<script src="./scripts/buscaTP.js"></script>
		<script src="./scripts/controle.js"></script>
		<script src="./scripts/cadastro.js"></script>
		<script src="./scripts/transporte.js"></script>
		<script src="./scripts/semleitor.js"></script>
		<script src="./scripts/senha.js"></script>
	</body>
</html>
